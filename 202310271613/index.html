<!DOCTYPE html>
<html lang="en">
    <head>
      <meta http-equiv="X-UA-Compatible" content="IE=edge">
      <meta http-equiv="content-type" content="text/html; charset=utf-8">

      <!-- Enable responsiveness on mobile devices-->
      <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

      <title>Leaflare - Mininet报错排查记录</title>

      

      
          <script src="https://cdnjs.cloudflare.com/ajax/libs/slideout/1.0.1/slideout.min.js"></script>
          
      

      
          <link rel="stylesheet" href="https://leaflare.github.io/site.css">
          
      

      
      
    </head>

    <body>
        <div class="container">

            <div id="mobile-navbar" class="mobile-navbar">
              <div class="mobile-header-logo">
                <a href="/" class="logo">Leaflare</a>
              </div>
              <div class="mobile-navbar-icon icon-out">
                <span></span>
                <span></span>
                <span></span>
              </div>
            </div>

            <nav id="mobile-menu" class="mobile-menu slideout-menu slideout-menu-left">
              <ul class="mobile-menu-list">
                
                    <li class="mobile-menu-item">
                        <a href="https:&#x2F;&#x2F;leaflare.github.io">
                            主页
                        </a>
                    </li>
                
                    <li class="mobile-menu-item">
                        <a href="https:&#x2F;&#x2F;leaflare.github.io&#x2F;categories">
                            分类
                        </a>
                    </li>
                
                    <li class="mobile-menu-item">
                        <a href="https:&#x2F;&#x2F;leaflare.github.io&#x2F;tags">
                            标签
                        </a>
                    </li>
                
                    <li class="mobile-menu-item">
                        <a href="https:&#x2F;&#x2F;github.com&#x2F;leaflare">
                            GitHub
                        </a>
                    </li>
                
              </ul>
            </nav>

            <header id="header">
                <div class="logo"><a href="https:&#x2F;&#x2F;leaflare.github.io">Leaflare</a></div>
                <nav class="menu">
                    <ul>
                        
                            <li>
                                <a href="https:&#x2F;&#x2F;leaflare.github.io">
                                    主页
                                </a>
                            </li>
                        
                            <li>
                                <a href="https:&#x2F;&#x2F;leaflare.github.io&#x2F;categories">
                                    分类
                                </a>
                            </li>
                        
                            <li>
                                <a href="https:&#x2F;&#x2F;leaflare.github.io&#x2F;tags">
                                    标签
                                </a>
                            </li>
                        
                            <li>
                                <a href="https:&#x2F;&#x2F;github.com&#x2F;leaflare">
                                    GitHub
                                </a>
                            </li>
                        
                    </ul>
                </nav>
            </header>

            <main>
                <div class="content" id="mobile-panel">
                    


<div class="post-toc" id="post-toc">
    <h2 class="post-toc-title">Contents</h2>
    <div class="post-toc-content always-active">
        <nav id="TableOfContents">
            <ul>
                
                <li>
                    <a href="https://leaflare.github.io/202310271613/#cai-keng-bao-cuo-jie-jue" class="toc-link">踩坑&amp;报错解决</a>
                    
                    <ul>
                        
                        <li>
                            <a href="https://leaflare.github.io/202310271613/#tuo-bu-bao-cun-he-mnwen-jian-da-kai-bao-cuo" class="toc-link">拓扑保存和.mn文件打开报错</a>
                        </li>
                        
                    </ul>
                    
                </li>
                
                <li>
                    <a href="https://leaflare.github.io/202310271613/#chang-yong-ming-ling" class="toc-link">常用命令</a>
                    
                </li>
                
            </ul>
        </nav>
    </div>
</div>


<article class="post">
    
    <header class="post__header">
        <h1 class="post__title">
            <a href="https:&#x2F;&#x2F;leaflare.github.io&#x2F;202310271613&#x2F;">Mininet报错排查记录</a>
        </h1>
        <div class="post__meta">
            <span class="post__time">2023-10-27</span>
            
        </div>
    </header>

    <div class="post-content">
      <span id="continue-reading"></span><h2 id="cai-keng-bao-cuo-jie-jue">踩坑&amp;报错解决</h2>
<h3 id="tuo-bu-bao-cun-he-mnwen-jian-da-kai-bao-cuo">拓扑保存和.mn文件打开报错</h3>
<p>环境：Ubuntu 22.04.3 LTS / mininet 2.3.1b4 </p>
<p>事故现场：在GUI绘制拓扑并保存为.mn文件时，出现报错：</p>
<pre style="background-color:#2b303b;color:#c0c5ce;"><code><span>TypeError: a bytes-like object is required, not &#39;str&#39;
</span></code></pre>
<p>问题解决：</p>
<p>mininet的GitHub issues中，有人建议使用Python 2启动mininet, 但使用Python 2保存后仍然无法重新打开保存的文件。</p>
<p>顺着Python2可以保存而Python3不能的思路，在GitHub issues中搜索Python版本相关问题，在Issue<a href="https://github.com/mininet/mininet/pull/1059">#1059</a> 中发现</p>
<pre style="background-color:#2b303b;color:#c0c5ce;"><code><span>dict.items() returns a list in python2 and a dict_items in python3. dict_items can&#39;t be added with +, which caused failures when using python3. This update changes this to dict.update() which works in both python2 and python3.
</span><span>
</span><span>When files are opened with f = open(filename, &quot;wb&quot;), the following calls to f.write expects bytes while miniedit provides regular strings. This works fine in python2, as python2 strings are bytes. This changed in python3, which caused miniedit to fail when saving files. This update changes the call to open() to use text-mode, which makes it possible to write strings regardless of python version.
</span></code></pre>
<p>注意到对<code>f.write</code>的调用需要字节，而<code>miniedit</code>提供了常规字符串，以及上文提到的miniedit文件，推测问题可能来自于miniedit文件中的相关部分。</p>
<p>查阅源码<em>mininet/examples/miniedit.py</em>  搜索<em>unicode</em></p>
<p>发现第1423行出现 globals.get('unicode', str)</p>
<pre data-lang="python" style="background-color:#2b303b;color:#c0c5ce;" class="language-python "><code class="language-python" data-lang="python"><span style="color:#b48ead;">def </span><span style="color:#8fa1b3;">convertJsonUnicode</span><span>(</span><span style="color:#bf616a;">self</span><span>, </span><span style="color:#bf616a;">text</span><span>):
</span><span>	&quot;</span><span style="color:#a3be8c;">Some part of Mininet don&#39;t like Unicode</span><span>&quot;
</span><span>	unicode = </span><span style="color:#96b5b4;">globals</span><span>.</span><span style="color:#bf616a;">get</span><span>( &#39;</span><span style="color:#a3be8c;">unicode</span><span>&#39;, str )
</span><span>	</span><span style="color:#b48ead;">if </span><span style="color:#96b5b4;">isinstance</span><span>(text, dict):
</span><span>		</span><span style="color:#b48ead;">return </span><span>{</span><span style="color:#bf616a;">self</span><span>.</span><span style="color:#bf616a;">convertJsonUnicode</span><span>(key): </span><span style="color:#bf616a;">self</span><span>.</span><span style="color:#bf616a;">convertJsonUnicode</span><span>(value) </span><span style="color:#b48ead;">for </span><span>key, value </span><span style="color:#b48ead;">in </span><span>text.</span><span style="color:#bf616a;">items</span><span>()}
</span><span>	</span><span style="color:#b48ead;">if </span><span style="color:#96b5b4;">isinstance</span><span>(text, list):
</span><span>		</span><span style="color:#b48ead;">return </span><span>[</span><span style="color:#bf616a;">self</span><span>.</span><span style="color:#bf616a;">convertJsonUnicode</span><span>(element) </span><span style="color:#b48ead;">for </span><span>element </span><span style="color:#b48ead;">in </span><span>text]
</span><span>	</span><span style="color:#b48ead;">if </span><span style="color:#96b5b4;">isinstance</span><span>(text, unicode):  </span><span style="color:#65737e;"># pylint: disable=undefined-variable
</span><span>		</span><span style="color:#b48ead;">return </span><span>text.</span><span style="color:#bf616a;">encode</span><span>(&#39;</span><span style="color:#a3be8c;">utf-8</span><span>&#39;)
</span><span>	</span><span style="color:#b48ead;">return </span><span>text
</span></code></pre>
<p>将其改为globals().get('str', bytes)：</p>
<pre data-lang="python" style="background-color:#2b303b;color:#c0c5ce;" class="language-python "><code class="language-python" data-lang="python"><span style="color:#b48ead;">def </span><span style="color:#8fa1b3;">convertJsonUnicode</span><span>(</span><span style="color:#bf616a;">self</span><span>, </span><span style="color:#bf616a;">text</span><span>):
</span><span>	&quot;</span><span style="color:#a3be8c;">Some part of Mininet don&#39;t like Unicode</span><span>&quot;
</span><span>	str_type = </span><span style="color:#96b5b4;">globals</span><span>().</span><span style="color:#bf616a;">get</span><span>(&#39;</span><span style="color:#a3be8c;">str</span><span>&#39;, bytes)
</span><span>	</span><span style="color:#b48ead;">if </span><span style="color:#96b5b4;">isinstance</span><span>(text, dict):
</span><span>		</span><span style="color:#b48ead;">return </span><span>{</span><span style="color:#bf616a;">self</span><span>.</span><span style="color:#bf616a;">convertJsonUnicode</span><span>(key): </span><span style="color:#bf616a;">self</span><span>.</span><span style="color:#bf616a;">convertJsonUnicode</span><span>(value) </span><span style="color:#b48ead;">for </span><span>key, value </span><span style="color:#b48ead;">in </span><span>text.</span><span style="color:#bf616a;">items</span><span>()}
</span><span>	</span><span style="color:#b48ead;">if </span><span style="color:#96b5b4;">isinstance</span><span>(text, list):
</span><span>		</span><span style="color:#b48ead;">return </span><span>[</span><span style="color:#bf616a;">self</span><span>.</span><span style="color:#bf616a;">convertJsonUnicode</span><span>(element) </span><span style="color:#b48ead;">for </span><span>element </span><span style="color:#b48ead;">in </span><span>text]
</span><span>	</span><span style="color:#b48ead;">if </span><span style="color:#96b5b4;">isinstance</span><span>(text, str_type):
</span><span>		</span><span style="color:#b48ead;">return </span><span>text.</span><span style="color:#bf616a;">encode</span><span>(&#39;</span><span style="color:#a3be8c;">utf-8</span><span>&#39;)
</span><span>	</span><span style="color:#b48ead;">return </span><span>text
</span></code></pre>
<p>问题解决!</p>
<h2 id="chang-yong-ming-ling">常用命令</h2>
<p>Python3启动mininet:</p>
<pre style="background-color:#2b303b;color:#c0c5ce;"><code><span>sudo python3 mininet/examples/miniedit.py
</span></code></pre>
<p>list all active Open vSwitches</p>
<pre style="background-color:#2b303b;color:#c0c5ce;"><code><span>sudo ovs-vsctl list-br
</span></code></pre>
<p>delete existing flows</p>
<pre style="background-color:#2b303b;color:#c0c5ce;"><code><span>sudo ovs-ofctl del-flows switch_name
</span></code></pre>
<p>e.g. “sudo ovs-ofctl del-flows s5&quot;</p>
<p>add flows</p>
<pre style="background-color:#2b303b;color:#c0c5ce;"><code><span>sudo ovs-ofctl add-flow switch_name ip,nw_dst=dst_ip,action=output:port_name
</span><span>sudo ovs-ofctl add-flow switch_name in_port=port_name,actions=output:port_name
</span><span>sudo ovs-ofctl add-flow switch_name arp,action=normal
</span></code></pre>
<p>e.g. &quot;sudo ovs-ofctl add-flow s1 ip,nw_dst=10.0.0.1,action=output:1&quot;</p>
<p>action=normal是必须的</p>
<p>show flows</p>
<pre style="background-color:#2b303b;color:#c0c5ce;"><code><span>sudo ovs-ofctl dump-flows switch_name
</span></code></pre>

    </div>

    
    

    <div class="post-footer">
        
            
                <div class="post-tags">
                    
                        <a href="https://leaflare.github.io/tags/web/">#Web</a>
                    
                </div>
            
            

        

    </div>

    
    
</article>


                </div>
            </main>

            
            
        </div>

      
          <script type="text/javascript" src="https://leaflare.github.io/even.js" ></script>
      
    </body>

</html>
